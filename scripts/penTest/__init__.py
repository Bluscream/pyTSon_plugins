from ts3plugin import ts3plugin, PluginHost
from random import choice, getrandbits, randint
from bluscream import timestamp, sendCommand, random_string, loadBadges, getContactStatus, ContactStatus
from PythonQt.QtCore import QTimer
import ts3defines, ts3lib, pytson

class penTest(ts3plugin):
    name = "Pen Tester"
    apiVersion = 21
    requestAutoload = True
    version = "1"
    author = "Bluscream"
    description = ""
    offersConfigure = False
    commandKeyword = "pt"
    infoTitle = None
    # path = "scripts/penTest"
    menuItems = []
    hotkeys = []
    timer = QTimer()
    cmd = ""
    def __init__(self):
        self.timer.timeout.connect(self.tick)
        if PluginHost.cfg.getboolean("general", "verbose"): ts3lib.printMessageToCurrentTab("{0}[color=orange]{1}[/color] Plugin for pyTSon by [url=https://github.com/{2}]{2}[/url] loaded.".format(timestamp(), self.name, self.author))

    def processCommand(self, schid, cmd):
        cmd = cmd.split(" ", 1)
        amount = 1
        try: amount = int(cmd[0])
        except: pass
        if amount > 10:
            self.i = 1
            self.schid = schid
            self.c = amount+1
            self.cmd = cmd[1]
            self.timer.start(1)
        else:
            for i in range(amount):
                sendCommand(self.name, cmd[1], schid, True)
                i += 1
        return True

    def tick(self):
        if self.i >= self.c: self.timer.stop()
        sendCommand(self.name, self.cmd, self.schid, True)
        self.i += 1

